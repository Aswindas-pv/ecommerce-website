{% extends 'admin_base.html' %}

{% block title %}
  <title>SneakerHeads Edit Product</title>
{% endblock %}

{% block custom_css %}
  {% load static %}
  <link rel="stylesheet" href="{% static 'admin_css/add_products.css' %}" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
  <div class="container main-container py-4">
    <form action="{% url 'edit_product' product.id %}" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <h1>Edit Product</h1>
      <div class="progress-bar">
        <div class="progress"></div>
      </div>
      {% if messages %}
        <div class="text-center mt-4 mb-4">
          {% for message in messages %}
            <h4>{{ message }}</h4>
          {% endfor %}
        </div>
      {% endif %}
      <div class="accordion">
        <div class="accordion-item">
          <h3 class="accordion-header py-4">Name & Description</h3>
          <div class="accordion-content">
            <label for="name">Product Name</label>
            <input type="text" id="name" name="product_name" value="{{ product.name }}" required />
            <label for="description">Description</label>
            <textarea id="description" required maxlength="1000" name="description" onkeyup="countChars(this)">{{ product.description }}</textarea>
          </div>
        </div>

        <div class="accordion-item">
          <h3 class="accordion-header">Inventory & Pricing</h3>
          <div class="accordion-content">
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" value="{{ product.quantity }}" name="quantity" min="0" required />
            <label for="price">Price</label>
            <input type="number" id="price" name="price" value="{{ product.price }}" step="1" min="0" required />
            <label for="category">Category</label>
            <select id="category" name="category" required>
                <option value="">Select Category</option>
                {% for category in category_list %}
                <option value="{{ category.id }}" {% if category.id == selected_category_id %}selected{% endif %}>{{ category.name }}</option>
                {% endfor %}
            </select>

            <label for="brand">Brand</label>
            <select id="brandSelect" name="brand" onchange="toggleBrandInput(this)">
                <option value="">Select Brand</option>
                {% for brand in brand_list %}
                <option value="{{ brand.id }}" {% if brand.id == selected_brand_id %}selected{% endif %}>{{ brand.name }}</option>
                {% endfor %}
            </select>
          </div>
        </div>
        <div class="accordion-item">
          <h3 class="accordion-header py-4">Products Images</h3>
          <div class="accordion-content">
            <p>Upload images for different views:</p>
            <div class="image-grid">
              <div class="form-group">
                <label for="main_image">Main Image:</label>
                <input type="file" id="main_image" name="main_image" accept="image/*" onchange="previewImage(this, 'main_image_preview')" />
                <div class="image-preview" id="main_image_preview">
                  <img src="{{ product.main_image.url }}" alt="{{ product.name }}" style="max-width: 100%; max-height: 100%;" />
                </div>
              </div>
              <div class="form-group">
                <label for="side_view_image">Side View Image:</label>
                <input type="file" id="side_view_image" name="side_view_image" accept="image/*" onchange="previewImage(this, 'side_view_image_preview')" />
                <div class="image-preview" id="side_view_image_preview">
                  <img src="{{ product.side_view_image.url }}" alt="{{ product.name }}" style="max-width: 100%; max-height: 100%;" />
                </div>
              </div>
              <div class="form-group">
                <label for="back_view_image">Back View Image:</label>
                <input type="file" id="back_view_image" name="back_view_image" accept="image/*" onchange="previewImage(this, 'back_view_image_preview')" />
                <div class="image-preview" id="back_view_image_preview">
                  <img src="{{ product.back_view_image.url }}" alt="{{ product.name }}" style="max-width: 100%; max-height: 100%;" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="row justify-content-between align-items-center">
          <div class="col-12 col-md-auto mb-3 mb-md-0 text-center text-md-start">
              {% if product.is_listed %}
                <a href="{% url 'un_list_product' product.id %}">
                  <button class="btn btn-dark rounded rounded-1 mb-2">UNLIST PRODUCT</button>
                </a>
              {% else %}
                <a href="{% url 'list_product' product.id %}">
                  <button class="btn btn-dark rounded rounded-1 mb-2">LIST PRODUCT</button>
                </a>
              {% endif %}
          </div>
          <div class="col-12 col-md-auto text-center text-md-end">
              <button type="submit" class="btn btn-dark rounded rounded-1 me-md-2 mb-2" onclick="return confirm('Are you sure you want to save changes?')">SAVE</button>
              <button class="btn btn-dark rounded rounded-1 mb-2" onclick="return confirm('Are you sure you want to delete this product?')">DELETE PRODUCT</button>
          </div>
      </div>
      
    </div>
    </form>
  </div>
{% endblock %}

{% block custom_scripts %}
  <script>
    function previewImage(input, previewId) {
      var preview = document.getElementById(previewId);
      var file = input.files[0];
      var reader = new FileReader();
    
      reader.onloadend = function () {
        var img = preview.getElementsByTagName('img')[0];
        img.src = reader.result;
      }
    
      if (file) {
        reader.readAsDataURL(file);
      }
    }
  </script>
{% endblock %}
